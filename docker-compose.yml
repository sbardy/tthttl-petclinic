version: "3.1"
services:
    config-service:
        build: ./config-service/.
        image: tthttl/config-service
        ports:
            - "8888:8888"
        networks:
            - internal
    discovery-service:
        build: ./discovery-service/.
        image: tthttl/discovery-service
        ports:
            - "8761:8761"
        depends_on:
            - config-service
        networks:
            - internal
    gateway-service:
        build: ./gateway-service/.
        image: tthttl/gateway-service
        ports:
            - "8080:8080"
        depends_on:
            - config-service
            - discovery-service
        networks:
            - internal
    tracing-service:
        image: openzipkin/zipkin
        ports:
            - "9411:9411"
        networks:
            - internal
    customer-db:
        image: mysql
        restart: always
        environment:
            MYSQL_ROOT_PASSWORD: 1234
            MYSQL_DATABASE: petclinic
        networks:
            - internal
        volumes:
            - ./customer-service:/docker-entrypoint-initdb.d
            - customer-data:/var/lib/mysql
    customer-service:
        build: ./customer-service/.
        image: tthttl/customer-service
        ports:
            - "8081:8081"
        depends_on:
            - config-service
            - discovery-service
            - customer-db
        networks:
            - internal
volumes:
    customer-data:

networks:
    internal: